{% extends 'base.html' %}
{% block content %}
<div class="content-section">
    <form method="POST" action="">
        {{ form.hidden_tag() }}
        <fieldset class="form-group">
            <legend class="border-bottom mb-4">{{ legend }}</legend>
            <div class="form-group">
                {{ form.lang.label(class="form-control-label") }}
                {% if form.lang.errors %}
                    {{ form.lang(class="form-control form-control-lg is-invalid") }}
                    <div class="invalid-feedback">
                        {% for error in form.lang.errors %}
                            <span>{{ error }}</span>
                        {% endfor %}
                    </div>
                {% else %}
                    {{ form.lang(class="form-control form-control-lg") }}
                {% endif %}
            </div>
            <div class="form-group">
                {{ form.title.label(class="form-control-label") }}
                {% if form.title.errors %}
                    {{ form.title(class="form-control form-control-lg is-invalid") }}
                    <div class="invalid-feedback">
                        {% for error in form.title.errors %}
                            <span>{{ error }}</span>
                        {% endfor %}
                    </div>
                {% else %}
                    {{ form.title(class="form-control form-control-lg") }}
                {% endif %}
            </div>
            <div class="form-group">
                {{ form.content.label(class="form-control-label") }}
                {% if form.content.errors %}
                    {{ form.content(class="form-control form-control-lg is-invalid") }}
                    <div class="invalid-feedback">
                        {% for error in form.content.errors %}
                            <span>{{ error }}</span>
                        {% endfor %}
                    </div>
                {% else %}
                    {{ form.content(class="form-control form-control-lg", data_editor="markdown") }}
                {% endif %}
            </div>
        </fieldset>
        <div class="form-group">
            {{ form.submit(class="btn btn-outline-info") }}
        </div>
    </form>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/ace.js"></script>
    <script type="text/javascript">
        // https://gist.github.com/duncansmart/5267653
        // find each text area marked to have an editor
        $('textarea[data-editor]').each(function() {
            var textarea = $(this);
            var mode = textarea.data('editor');
            // create the editor div
            var div = $('<div>', {
                'width': textarea.outerWidth(),
                'height': textarea.outerHeight(),
                'class': textarea.attr('class')
            }).insertBefore(textarea);
            // hide the original text area
            textarea.hide();
            // configure the editor
            var editor = ace.edit(div[0]);
            var session = editor.getSession();
            editor.setTheme("ace/theme/github");
            session.setValue(textarea.val());
            session.setMode('ace/mode/' + mode);
            session.setNewLineMode('unix');
            session.setTabSize(4);
            session.setUseSoftTabs(true);
            session.setUseWrapMode(true);
            // update the text area before submitting the form
            textarea.closest('form').submit(function() {
                textarea.val(editor.getSession().getValue());
            });
        });
    </script>
</div>
{% endblock content %}
